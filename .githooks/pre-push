#!/usr/bin/env bash
set -euo pipefail

# pre-push: Block pushes to protected branches
# Ensures feature branch workflow is followed.

# Block pushes to protected branches
blocked=false
while read -r local_ref local_sha remote_ref remote_sha; do
  if [[ "$remote_ref" == "refs/heads/main" || "$remote_ref" == "refs/heads/master" ]]; then
    blocked=true
  fi
done

if [[ "$blocked" == true ]]; then
  echo "✋ Blocked: pushing to a protected branch ('main'/'master') is not allowed."
  echo "➡️  Use a feature branch and open a PR."
  exit 1
fi

exit 0
